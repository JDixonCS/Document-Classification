---
title: "Programming Summary"
author: "Jose Dixon"
date: "June 16, 2022"
output:
  word_document: default
  pdf_document: default
  html_document:
    code_folding: show
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, error = TRUE)
```


```{r Load Libraries}
library(tidyverse)
library(reshape)
library(ggplot2)
library(modelr)
library(tinytex)
options(na.action = na.warn)
```


Hadley Wickman Intro to Data Science
This is the website for “R for Data Science”.<https://r4ds.had.co.nz>

```{r WD}
getwd()
```


```{r Loading Data}
table <- read.csv("~/Document-Classification/classifier/NIST_Complete_Iterations.csv")
head(table)
```
<br>
```{r Assignment}
accuracy = table[, 12]
auc = table[, 11]
recall = table[, 10]
precision = table[, 9]
trainingdata = table[, 8]
split = table[, 7]
trainsplitsize = table[, 6]
testsplitsize = table[, 5]
classifier = table[, 4]
sampling = table[, 2]
technique = table[, 3]
year = table[, 1]
```

```{r T-Test Code}

dat1 <- data.frame(
  samplepre = precision,
  samplerec = recall
)
dat1

dat_ggplot <- data.frame(
  pvalue = c(precision), c(recall),
  sample = c(rep("precision", 4500), rep("recall", 4500))
)

ggplot(dat_ggplot) +
  aes(x = sample, y = pvalue) +
  geom_boxplot() +
  theme_minimal()

boxplot(pvalue ~ sample,
  data = dat_ggplot
)


t.test(precision, y =(recall))
plot(precision ~ recall, data = table)
```
<br >

## Chapter 3 Data Visualization
```{r Chapter 3 Graph 1}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall))
```
<br>
```{r Chapter 3 Graph 2}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall))
```
<br>
```{r Chapter 3 Graph 3}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall))
```
<br>
```{r Chapter 3 Graph 4}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall, color = technique))
```
<br>
```{r Chapter 3 Graph 5}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall, size = technique))
```
<br>
```{r Chapter 3 Graph 6}
# Left
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall, alpha = technique))
```
<br>
```{r Chapter 3 Graph 7}
# Right
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall, shape = technique))
```
<br >
```{r Chapter 3 Graph 8}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall), color = "blue")
```
<br>
```{r Chapter 3 Graph 9}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall)) + facet_wrap(~ Technique, nrow = 2)
```
<br>
```{r Chapter 3 Graph 10}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall)) + 
  facet_grid(Sampling ~ Technique)
```
<br>
```{r Chapter 3 Graph 11}
ggplot(table, aes(precision, recall)) + geom_boxplot()
```
<br>
```{r Chapter 3 Graph 12}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall)) +
  geom_smooth(mapping = aes(x = precision, y = recall))
```
```{r Chapter 3 Graph 13}
ggplot(data = table) + 
  stat_summary(
    mapping = aes(x = precision, y = recall),
    fun.min = min,
    fun.max = max,
    fun = median
  )
```
<br>
```{r Chapter 3 EC 1}
# Problematic Code
# ggplot(table, aes(x = precision, y = recall)) + 
#   geom_point(size = 2, colour = "grey30") + 
#   geom_abline(
#     aes(intercept = a1, slope = a2, colour = -dist), 
#     data = table(models, rank(dist) <= 10)
#   )
# Error in x[!nas] : object of type 'closure' is not subsettable
```
<br>
```{r Chapter 3 Graph 14 Classifier}
ggplot(data = table) +
   geom_boxplot(mapping = aes(x=precision, y=recall, alpha = classifier))
```
<br>
```{r Chapter 3 Graph 14 Sampling}
ggplot(data = table) +
   geom_boxplot(mapping = aes(x=precision, y=recall, alpha = sampling))
```
<br>
```{r Chapter 3 Graph 14 Technique}
ggplot(data = table) +
   geom_boxplot(mapping = aes(x=precision, y=recall, alpha = technique))
```
<br>
```{r Chapter 3 Graph 15 Classifier}
ggplot(data = table) +
  geom_count(mapping = aes(x = precision, y = recall, alpha = classifier))
```
<br>
```{r Chapter 3 Graph 15 Sampling}
ggplot(data = table) +
  geom_count(mapping = aes(x = precision, y = recall, alpha = sampling))
```
<br>
```{r Chapter 3 Graph 15 Technique}
ggplot(data = table) +
  geom_count(mapping = aes(x = precision, y = recall, alpha = technique))
```
<br>
```{r Chapter 3 Graph 16}
x <- precision
y <- recall
ggplot(table) + 
  geom_histogram(mapping = aes(x = y), binwidth = 0.1)
```
<br>
```{r Chapter 3 Graph 17}
ggplot(data = table) + 
  geom_point(mapping = aes(x = precision, y = recall))
```
<br >

## Chapter 7 EDA
```{r Chapter 7 EDA Graph 1 Classifier}
ggplot(data = table) +
  geom_bar(mapping = aes(x = classifier))
```
<br>
```{r Chapter 7 EDA Graph 1 Sampling}
ggplot(data = table) +
  geom_bar(mapping = aes(x = sampling))
```
<br>
```{r Chapter 7 EDA Graph 1 Technique}
ggplot(data = table) +
  geom_bar(mapping = aes(x = technique))
```
<br> 
```{r Chapter 7 EDA Stat 1}
table %>% 
  count(cut_width(Precision, 0.5))
```
```{r Chapter 7 EDA Stat 2}
table %>% 
  count(Classifier)
```
<br>
```{r Chapter 7 EDA Stat 3}
table %>% 
  count(cut_width(Recall, 0.5))
```
<br>
```{r Chapter 7 EDA Stat 4}
smaller <- table %>%
  filter(Classifier > 60)
```
<br>
```{r Chapter 7 EDA Graph 2}
ggplot(data = smaller, mapping = aes(x = Precision)) +
  geom_histogram(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 3}
ggplot(data = smaller, mapping = aes(x = Recall)) +
  geom_histogram(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Classifier ~ Precision}
ggplot(data = smaller, mapping = aes(x = Precision, colour = classifier)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Sampling ~ Precision}
ggplot(data = smaller, mapping = aes(x = Precision, colour = sampling)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Technique ~ Precision}
ggplot(data = smaller, mapping = aes(x = Precision, colour = technique)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Classifier ~ Recall}
ggplot(data = smaller, mapping = aes(x = Recall, colour = classifier)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Sampling}
ggplot(data = smaller, mapping = aes(x = Recall, colour = sampling)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 4 Technique}
ggplot(data = smaller, mapping = aes(x = Recall, colour = technique)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 5}
ggplot(data = smaller, mapping = aes(x = Recall)) +
  geom_histogram(binwidth = 0.01)
```
<br>
```{r Chapter 7 EDA Graph 6}
ggplot(data = smaller, mapping = aes(x = Precision, colour = classifier)) +
  geom_freqpoly(binwidth = 0.1)
```
<br>
```{r Chapter 7 EDA Graph 7}
ggplot(data = smaller, mapping = aes(x = Precision)) +
  geom_histogram(binwidth = 0.01)
```
```{r Chapter 7 EDA Graph 8}
ggplot(data = smaller, mapping = aes(x = Precision)) + 
  geom_histogram(binwidth = 0.25)
```
<br>
```{r Chapter 7 EDA Graph 9}
ggplot(table) + 
  geom_histogram(mapping = aes(x = y), binwidth = 0.5)
```
<br>
```{r Chapter 7 EDA Graph 10}
ggplot(table) + 
  geom_histogram(mapping = aes(x = y), binwidth = 0.5) +
  coord_cartesian(ylim = c(0, 50))
```
# unusual <- table %>% 
#   filter(y < 30 | y > 60) %>% 
#   select(x, y) %>%
#   arrange(y)
# unusual
```{r Chapter 7 EDA Graph 11}
ggplot(data = table, mapping = aes(x = x, y = y)) + 
  geom_point()
```
<br>
```{r Chapter 7 EDA Graph 12}
ggplot(data = table, mapping = aes(x = x, y = y)) + 
  geom_point(na.rm = TRUE)
```
```{r Chapter 7 EDA Graph 13 Classifier}
ggplot(data = table, mapping = aes(x = precision)) + 
  geom_freqpoly(mapping = aes(colour = classifier), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 13 Sampling}
ggplot(data = table, mapping = aes(x = precision)) + 
  geom_freqpoly(mapping = aes(colour = sampling), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 13 Technique}
ggplot(data = table, mapping = aes(x = precision)) + 
  geom_freqpoly(mapping = aes(colour = technique), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 14 Recall ~ Classifier}
ggplot(data = table, mapping = aes(x = recall)) + 
  geom_freqpoly(mapping = aes(colour = classifier), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 14 Recall ~ Sampling}
ggplot(data = table, mapping = aes(x = recall)) + 
  geom_freqpoly(mapping = aes(colour = sampling), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 14 Recall ~ Technique}
ggplot(data = table, mapping = aes(x = recall)) + 
  geom_freqpoly(mapping = aes(colour = technique), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 15 Classifier}
ggplot(data = table, mapping = aes(x = precision, y = ..recall..)) + 
  geom_freqpoly(mapping = aes(colour = classifier), binwidth = 500)
```
<br>
```{r Chapter 7 EDA Graph 16}
ggplot(data = table, mapping = aes(x = precision, y = recall)) +
  geom_boxplot()
```
```{r Chapter 7 EDA Graph 17 Classifier}
ggplot(data = table, mapping = aes(x = classifier, y = precision)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 17 Sampling}
ggplot(data = table, mapping = aes(x = sampling, y = precision)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 17 Technique}
ggplot(data = table, mapping = aes(x = technique, y = precision)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 18 Classifier}
ggplot(data = table, mapping = aes(x = classifier, y = recall)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 18 Sampling}
ggplot(data = table, mapping = aes(x = sampling, y = recall)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 18 Technique}
ggplot(data = table, mapping = aes(x = technique, y = recall)) +
  geom_boxplot()
```
<br>
```{r Chapter 7 EDA Graph 19 Classifier and Precision RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(classifier, precision, FUN = median), y = precision))
```
<br>
```{r Chapter 7 EDA Graph 19 Classifier and Recall RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(classifier, recall, FUN = median), y = recall))
```
<br>
```{r Chapter 7 EDA Graph 19 Sampling and Precision RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(sampling, precision, FUN = median), y = precision))
```
<br>
```{r Chapter 7 EDA Graph 19 Sampling and Recall RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(sampling, recall, FUN = median), y = recall))
```
<br>
```{r Chapter 7 EDA Graph 19 Technique and Precision RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(technique, precision, FUN = median), y = precision))
```
<br>
```{r Chapter 7 EDA Graph 19 Technique and Recall RO}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(technique, recall, FUN = median), y = recall))
```
<br>
```{r Chapter 7 EDA Graph 20 Coordflip}
ggplot(data = table) +
  geom_boxplot(mapping = aes(x = reorder(classifier, precision, FUN = median), y = precision)) +
  coord_flip()
```
<br>
```{r Chapter 7 EDA Graph 21}
ggplot(data = table) +
  geom_count(mapping = aes(x = classifier, y = sampling))
```
<br>
```{r Chapter 7 EDA Graph 22}
table %>% 
  count(Classifier, Sampling)
table %>% 
  count(Classifier, Sampling) %>%  
  ggplot(mapping = aes(x = Classifier, y = Sampling)) +
  geom_tile(mapping = aes(fill = n))
```
<br>
```{r Chapter 7 EDA Graph 23}
ggplot(data = table) + 
  geom_point(mapping = aes(x = Precision, y = Recall), alpha = 50 / 100)
```
<br>
```{r Chapter 7 EDA Graph 24}
ggplot(data = smaller) +
  geom_bin2d(mapping = aes(x = Precision, y = Recall))
```
<br>
```{r Load Hexbin}
# install.packages("hexbin")
library(hexbin)
```
<br>
```{r Chapter 7 EDA Graph 25}
ggplot(data = smaller) +
  geom_hex(mapping = aes(x = Precision, y = Recall))
```
<br>
```{r Chapter 7 EDA Graph 26}
ggplot(data = smaller, mapping = aes(x = Precision, y = Recall)) + 
  geom_boxplot(mapping = aes(group = cut_width(Precision, 0.1)))
```
<br>
```{r Chapter 7 EDA Graph 27}
ggplot(data = smaller, mapping = aes(x = Precision, y = Recall)) + 
  geom_boxplot(mapping = aes(group = cut_number(Precision, 20)))
```
<br>
```{r Chapter 7 EDA Graph 28}
ggplot(data = table) +
  geom_point(mapping = aes(x = x, y = y)) +
  coord_cartesian(xlim = c(0, 90), ylim = c(0, 90))
```
<br>
```{r Chapter 7 EDA Graph 29}
ggplot(data = table) + 
  geom_point(mapping = aes(x = Precision, y = Recall))
```
<br>
```{r Load modelr}
library(modelr)
```
<br>
```{r Chapter 7 EDA Resid 1}
mod <- lm(log(Recall) ~ log(Precision), data = table)

table1 <- table %>% 
  add_residuals(mod) %>% 
  mutate(resid = exp(resid))
```
<br>
```{r Chapter 7 EDA Graph 30}
ggplot(data = table1) + 
  geom_point(mapping = aes(x = Precision, y = resid))
```
<br>
```{r Chapter 7 EDA Graph 31}
ggplot(data = table1) + 
  geom_boxplot(mapping = aes(x = Precision, y = resid))
```
<br>
```{r Chapter 7 EDA Graph 32}
ggplot(data = table, mapping = aes(x = precision)) + 
  geom_freqpoly(binwidth = 0.25)
```
<br>
```{r Chapter 8 EDA Graph 33}
ggplot(table, aes(Precision)) + 
  geom_freqpoly(binwidth = 0.25)
```
<br>
```{r Chapter 8 EDA Graph 34}
table %>% 
  count(Classifier, Sampling) %>% 
  ggplot(aes(Classifier, Sampling, fill = n)) + 
  geom_tile()
```
<br>

Chapter 9 Wrangle
```{r Chapter 9 Wrangle 0}
table %>% 
  count(Precision) %>% 
  filter(n > 1)
```
<br >
```{r Chapter 9 Wrangle 1}
table %>% 
  count(Recall) %>% 
  filter(n > 1)
```
<br>
```{r Chapter 9 Wrangle 2}
table %>% 
  count(Precision, Recall) %>% 
  filter(n > 1)
```
<br>

## Chapter 23 Model Basics
```{r Chapter 23 Model Basics}
x <- precision
y <- recall
# models <- tibble(
#   a1 = c(precision),
#   a2 = c(recall)
# )
```
<br>
```{r Chapter 23 Plot 1}
models <- tibble(
  a1 = precision,
  a2 = recall
)
models
ggplot(table, aes(x=precision, y=recall)) + 
  geom_abline(aes(intercept = a1, slope = a2), data = models, alpha = 1/4) +
  geom_point()
```
```{r Chapter 23 Model Basics Statc1}
foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
model1 <- function(a, data) {
  a[1] + data$x * a[2]
}

# model1(c(7, 1.5), table)
#>  [1]  8.5  8.5  8.5 10.0 10.0 10.0 11.5 11.5 11.5 13.0 13.0 13.0 14.5 14.5 14.5
#> [16] 16.0 16.0 16.0 17.5 17.5 17.5 19.0 19.0 19.0 20.5 20.5 20.5 22.0 22.0 22.0

measure_distance <- function(mod, data) {
  diff <- data$y - model1(mod, data)
  sqrt(mean(diff ^ 2))
}

table_dist <- function(a1, a2) {
  measure_distance(c(a1, a2),table)
}
# test2 <- c(precision[1],recall[2])
# test2
# measure_distance(c(7.5, 1), table)

models <- models %>% 
  mutate(dist = purrr::map2_dbl(a1, a2, table_dist))
models
```
#> # A tibble: 250 x 3
#>       a1      a2  dist
#>    <dbl>   <dbl> <dbl>
#> 1 -15.2   0.0889  30.8
#> 2  30.1  -0.827   13.2
#> 3  16.0   2.27    13.2
#> 4 -10.6   1.38    18.7
#> 5 -19.6  -1.04    41.8
#> 6   7.98  4.59    19.3
#> # … with 244 more rows
```{r Chapter 23 Plot 2}
ggplot(table, aes(x = precision, y = recall)) + 
  geom_point(size = 2, colour = "grey30") + 
  geom_abline(
    aes(intercept = a1, slope = a2, colour = -dist), 
    data = filter(models, rank(dist) <= 10)
  )
```
<br>
```{r Chapter 23 Plot 3}
ggplot(models, aes(a1, a2)) +
  geom_point(data = filter(models, rank(dist) <= 10), size = 4, colour = "red") +
  geom_point(aes(colour = -dist))
```
<br>
```{r Chapter 23 Plot 4}
grid <- expand.grid(
  a1 = seq(-5, 20, length=25, along.with=precision),
  a2 = seq(1, 3, length = 25, along.with=recall)
) %>% 
  mutate(dist = purrr::map2_dbl(a1, a2, table_dist))
```
<br>
```{r Chapter 23 Plot 5}
grid %>% 
  ggplot(aes(a1, a2)) +
  geom_point(data = filter(grid, rank(dist) <= 10), size = 4, colour = "red") +
  geom_point(aes(colour = -dist)) 
```
<br>
```{r Chapter 23 Plot 6}
ggplot(table, aes(x=precision, y=recall)) + 
  geom_point(size = 2, colour = "grey30") + 
  geom_abline(
    aes(intercept = a1, slope = a2, colour = -dist), 
    data = filter(grid, rank(dist) <= 10)
  )
```
# best <- optim(c(0, 0), measure_distance, data = table)
# best$par

# ggplot(table, aes(x, y)) + 
#   geom_point(size = 2, colour = "grey30") + 
#   geom_abline(intercept = best$par[1], slope = best$par[2])
```{r Chapter 23 Plot 7}
table_mod <- lm(y ~ x, data = table)
coef(table_mod)

tablea <- tibble(
  x = rep(1:10, each = 3),
  y = x * 1.5 + 6 + rt(length(x), df = 2)
)

measure_distance <- function(mod, data) {
  diff <- data$y - model1(mod, data)
  mean(abs(diff))
}

model1 <- function(a, data) {
  a[1] + data$x * a[2] + a[3]
}

grid <- table %>% 
  data_grid(x) 
grid
```
```{r Chapter 23 Plot 8}
#> # A tibble: 10 x 1
#>       x
#>   <int>
#> 1     1
#> 2     2
#> 3     3
#> 4     4
#> 5     5
#> 6     6
#> # … with 4 more rows

grid <- grid %>% 
  add_predictions(table_mod) 
grid
#> # A tibble: 10 x 2
#>       x  pred
#>   <int> <dbl>
#> 1     1  6.27
#> 2     2  8.32
#> 3     3 10.4 
#> 4     4 12.4 
#> 5     5 14.5 
#> 6     6 16.5 
#> # … with 4 more rows

ggplot(table, aes(x)) +
  geom_point(aes(y = y)) +
  geom_line(aes(y = pred), data = grid, colour = "red", size = 1)
```
```{r Chapter 23 Plot 9}
table <- table %>% 
  add_residuals(table_mod)
table
#> # A tibble: 30 x 3
#>       x     y  resid
#>   <int> <dbl>  <dbl>
#> 1     1  4.20 -2.07 
#> 2     1  7.51  1.24 
#> 3     1  2.13 -4.15 
#> 4     2  8.99  0.665
#> 5     2 10.2   1.92 
#> 6     2 11.3   2.97 
#> # … with 24 more rows

ggplot(table, aes(resid)) + 
  geom_freqpoly(binwidth = 0.5)
```
<br>
```{r Chapter 23 Plot 10}
ggplot(table, aes(x, resid)) + 
  geom_ref_line(h = 0) +
  geom_point() 
```
<br>
```{r Chapter 23 Plot 11}
ggplot(table) + 
  geom_point(aes(x, y))
```
<br> 
```{r Chapter 23 Plot 12}
mod2 <- lm(y ~ x, data = table)

grid <- table %>% 
  data_grid(x) %>% 
  add_predictions(mod2)
grid
```
<br>
```{r Chapter 23 Plot 13}
#> # A tibble: 4 x 2
#>   x      pred
#>   <chr> <dbl>
#> 1 a      1.15
#> 2 b      8.12
#> 3 c      6.13
#> 4 d      1.91

ggplot(table, aes(x)) + 
  geom_point(aes(y = y)) +
  geom_point(data = grid, aes(y = pred), colour = "red", size = 4)
```
<br>
```{r Chapter 23 Plot 14 Classifier}
# tibble(x = "e") %>% 
#   add_predictions(mod2)

ggplot(table, aes(x, y)) + 
  geom_point(aes(colour = classifier))
#> Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor x has new level e
```
<br>
```{r Chapter 23 Plot 14 Sampling}
# tibble(x = "e") %>% 
#   add_predictions(mod2)

ggplot(table, aes(x, y)) + 
  geom_point(aes(colour = sampling))
#> Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor x has new level e
```
<br>
```{r Chapter 23 Plot 14 Technique}
# tibble(x = "e") %>% 
#   add_predictions(mod2)

ggplot(table, aes(x, y)) + 
  geom_point(aes(colour = technique))
#> Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor x has new level e
```
<br>
```{r Chapter 23 Plot 15}
mod1 <- lm(y ~ x + classifier, data = table)
mod2 <- lm(y ~ x * classifier, data = table)

grid <- table %>% 
  data_grid(x, classifier) %>% 
  gather_predictions(mod1, mod2)
grid
```

<br># # Problematic Code
```{r Chapter 23 Plot 16 Classifier}
ggplot(foo, aes(x, y, colour = classifier)) +
  geom_point() +
  geom_line(data = grid, aes(y = pred)) +
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 17}
# Leftover Code
#> # A tibble: 80 x 4
#>   model    x1 x2     pred
#>   <chr> <int> <fct> <dbl>
#> 1 mod1      1 a      1.67
#> 2 mod1      1 b      4.56
#> 3 mod1      1 c      6.48
#> 4 mod1      1 d      4.03
#> 5 mod1      2 a      1.48
#> 6 mod1      2 b      4.37
#> # … with 74 more rows
ggplot(table, aes(x=precision, y=recall)) + 
  geom_point(size = 2, colour = "grey30")
```
<br>
```{r Chapter 23 Plot 18}
# best <- optim(c(0, 0), measure_distance, data = table)
# best$par
# #> [1] 4.222248 2.051204
# 
# data_dist <- function(x, y) {
#   measure_distance(c(x, y), table)
# }
# 
 # models <- foo %>%
 #   mutate(dist = purrr::foo(x, y, data_dist))
 # models
#  ggplot(table, aes(x=precision, y=recall)) + 
#     geom_point(size = 2, colour = "grey30") + 
#     geom_abline(intercept = best$par[1], slope = best$par[2])
#  ggplot(classifier, aes(color, price)) + geom_boxplot()
#  ggplot(classifier, diamonds, aes(clarity, price)) + geom_boxplot()
#
 
ggplot(foo, aes(x, y)) +
  geom_point(size = 2, colour = "grey30") +
  geom_abline(
    aes(intercept = a1, slope = a2, colour = -dist),
    data = filter(models, rank(dist) <= 0)
  )
```
<br>
```{r Chapter 23 Plot 19 Classifier}
# grid <- expand.grid(
#   a1 = seq(-5, 20, length = 25),
#   a2 = seq(1, 3, length = 25)
# ) %>% 
#   mutate(dist = purrr::map2_dbl(x, y, data_dist))
# 
# grid %>% 
#   ggplot(aes(x, y)) +
#   geom_point(data = filter(grid, rank(dist) <= 10), size = 4, colour = "red") +
#   geom_point(aes(colour = -dist)) 
#
foo <- foo %>% 
  gather_residuals(mod1, mod2)

ggplot(foo, aes(x, y, colour = classifier)) + 
  geom_point() + 
  facet_grid(model ~ classifier)

mod1 <- lm(y ~ x + classifier, data = table)
mod2 <- lm(y ~ x * classifier, data = table)
```
<br>
```{r Chapter 23 Plot 19 Sampling}
ggplot(foo, aes(x, y, colour = sampling)) + 
  geom_point() + 
  facet_grid(model ~ sampling)
```
<br>
```{r Chapter 23 Plot 20 Classifier}

mod1 <- lm(y ~ x + classifier, data = table)
mod2 <- lm(y ~ x * classifier, data = table)

# Problematic Code
# grid <- foo %>% 
#   data_grid(
#     x = seq_range(x, 5), 
#     y = seq_range(y, 5) 
#   ) %>% 
#   gather_predictions(mod1, mod2)
# grid


ggplot(foo, aes(x, y)) + 
  geom_tile(aes(y = classifier)) + 
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot Sampling}
ggplot(foo, aes(x, y)) +
  geom_tile(aes(y = sampling)) + 
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 21 Classifier}
ggplot(foo, aes(x, y, colour= classifier, group = classifier)) + 
  geom_line() +
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 21 Sampling}
ggplot(foo, aes(x, y, colour= classifier, group = sampling)) + 
  geom_line() +
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 22 Classifier}
ggplot(foo, aes(y, x, colour = classifier, group = classifier)) + 
  geom_line() +
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 22 Sampling}
ggplot(foo, aes(y, x, colour = sampling, group = sampling)) + 
  geom_line() +
  facet_wrap(~ model)
```
<br>
```{r Chapter 23 Plot 23 Classifier}
ggplot(foo, aes(x, y)) + 
  geom_tile(aes(fill = classifier)) + 
  facet_wrap(~ model)
```
<br>

## Chapter 24 Model Building
```{r Chapter 24 Model Building}
library(tidyverse)
library(modelr)
options(na.action = na.warn)

# library(nycflights13)
# library(lubridate)
# 24.2
ggplot(foo, aes(x, classifier)) + geom_boxplot()
```
```{r Chapter 24 Plot 2}
ggplot(foo, aes(y, classifier)) + geom_boxplot()
```
<br>
<br>
# 24.2.1
```{r Chapter 24 Plot 3}
ggplot(foo, aes(x, y)) + 
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 4 Classifier}
ggplot(foo, aes(x, classifier)) + 
  geom_hex(bins = 50)
```
```{r Chapter 24 Plot 4 Sampling}
ggplot(foo, aes(x, sampling)) + 
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 5 Classifier}
ggplot(foo, aes(y, classifier)) + 
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 5 Sampling}
ggplot(foo, aes(y, sampling)) + 
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 6}
# Code to ignore
# foo <- foo %>% 
#   add_residuals(mod_foo, "lclassifier")
# 
# ggplot(foo, aes(x, lclassifier)) + 
#   geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 7 Classifier}
# grid <- foo2 %>% 
#   data_grid(x = seq_range(x), 20)) %>% 
#   mutate(x = log2(x)) %>% 
#   add_predictions(mod_foo2, "l_x") %>% 
#   mutate(x = 2 ^ x)

lm1 <- lm(y ~ classifier, data=foo)
lm2 <- lm(x ~ classifier, data=foo)

ggplot(foo, aes(x, y)) + 
  geom_hex(bins = 50) + 
  geom_line(data = foo, colour = "red", size = 1)
```
<br>
```{r Chapter 24 Plot 7 Sampling}
# grid <- foo2 %>% 
#   data_grid(x = seq_range(x), 20)) %>% 
#   mutate(x = log2(x)) %>% 
#   add_predictions(mod_foo2, "l_x") %>% 
#   mutate(x = 2 ^ x)

lm1 <- lm(y ~ sampling, data=foo)
lm2 <- lm(x ~ sampling, data=foo)

ggplot(foo, aes(x, y))  + 
  geom_hex(bins = 50) + 
  geom_line(data = foo, colour = "red", size = 1)
```
<br>
```{r Chapter 24 Plot 8}
# foo <- foo %>%
#   filter(x <= 1) %>%
#   mutate(l_x = log2(l_x), l_y = log2(y))

 # ggplot(foo, aes(l_x, l_y)) + 
 #   geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 9 - Precision and Classifier}
mod_foo <- lm(x ~ y, data = foo)
foo <- foo %>% 
  add_residuals(mod_foo, "classifier")

ggplot(foo, aes(x, classifier)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 9 - Recall and Classifier}
mod_foo <- lm(x ~ y, data = foo)
foo <- foo %>% 
  add_residuals(mod_foo, "classifier")

ggplot(foo, aes(y, classifier)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 10 Precision and Sampling }
ggplot(foo, aes(x, sampling)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 10 Recall and Sampling}
ggplot(foo, aes(y, sampling)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 9}
mod_foo <- lm(x ~ y, data = foo)
foo <- foo %>% 
  add_residuals(mod_foo, "classifier")

ggplot(foo, aes(x, classifier)) + geom_boxplot()
ggplot(foo, aes(y, classifier)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 10}
foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
mod_foo <- lm(y ~ x + classifier + sampling + technique, data = foo)
mod_foo <- lm(y ~ x, data = foo)
# grid <- foo2 %>%
#   data_grid(x = seq_range(x, 225)) %>%
#   mutate(l_x = log2(x)) %>%
#   add_predictions(mod_foo2, "l_y") %>%
#   mutate(l_y = log2(y))

foo <- foo %>%
    add_residuals(mod_foo, "technique")

ggplot(foo, aes(x, technique)) + 
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 11}
ggplot(foo, aes(y, technique)) +
  geom_hex(bins = 50)
```
<br>
```{r Chapter 24 Plot 12}
ggplot(foo, aes(x, technique)) + geom_boxplot()
```
<br>
```{r Chapter 24 Plot 13}
ggplot(foo, aes(y, technique)) + geom_boxplot()
```

<br>

## Chapter 24.2.2 
```{r Chapter 24.2.2}
 foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
 mod_foo <- lm(y ~ x + classifier + sampling + technique, data = foo)

grid <- foo %>% 
  data_grid(classifier, .model = mod_foo) %>% 
  add_predictions(mod_foo) 
grid

```
```{r Chapter 24.2.2 Plot 14}
ggplot(grid, aes(x, pred)) + 
  geom_point()
```
<br>
```{r Chapter 24.2.2 Plot 15}
#> # A tibble: 5 x 5
#>   cut       lcarat color clarity  pred
#>   <ord>      <dbl> <chr> <chr>   <dbl>
#> 1 Fair      -0.515 G     VS2      11.2
#> 2 Good      -0.515 G     VS2      11.3
#> 3 Very Good -0.515 G     VS2      11.4
#> 4 Premium   -0.515 G     VS2      11.4
#> 5 Ideal     -0.515 G     VS2      11.4

ggplot(grid, aes(classifier, pred)) + 
  geom_point()
```
<br>
# 24.2.2
```{r Chapter 24.2.2 Plot 16}
 foo <- foo %>% 
 add_residuals(mod_foo, "lclassifier")

 ggplot(foo, aes(x, lclassifier)) + 
    geom_hex(bins = 50)
```
<br>
```{r Chapter 24.2.2 Plot 17}
foo <- foo %>% 
  add_residuals(mod_foo)


ggplot(foo, aes(x, classifier)) + 
  geom_line()
```
<br>

## Chapter 24.3

```{r Chapter 24.3 Plot 18 Classifier}
# foo2 %>%
# filter(abs(l_x) > 1) %>%
#  add_predictions(mod_foo) %>%
#  mutate(pred = pred) %>%
#  select(l_x, pred, l_y:all_of(foo), x:y) %>%
#  arrange(x)

ggplot(foo, aes(x, classifier)) + 
  geom_line()
```
<br>
```{r Chapter 24.3 Plot 18 Sampling}
# foo2 %>%
# filter(abs(l_x) > 1) %>%
#  add_predictions(mod_foo) %>%
#  mutate(pred = pred) %>%
#  select(l_x, pred, l_y:all_of(foo), x:y) %>%
#  arrange(x)

ggplot(foo, aes(x, sampling)) + 
  geom_line()

```
<br>
```{r Chapter 24.3 Plot 20}
ggplot(foo, aes(x, y)) + 
  geom_line()
```
<br>

# # Chapter 24.3.1
```{r Chapter 24.3.1 Plot 21 Classifier}
ggplot(foo, aes(classifier, x)) + 
  geom_boxplot()
```
<br> 
```{r Chapter 24.3.1 Plot 21 Sampling}
ggplot(foo, aes(sampling, x)) + 
  geom_boxplot()
```
<br>
```{r Chapter 24.3.1 Plot 22 Classifier}
ggplot(foo, aes(classifier, y)) + 
  geom_boxplot()
```
<br>
```{r Chapter 24.3.1 Plot 22 Sampling}
ggplot(foo, aes(sampling, y)) + 
  geom_boxplot()
```
<br>
```{r Chapter 24.3.1 Plot 23 Classifier}
mod <- lm(x ~ classifier, data = foo)


grid <- foo %>% 
  data_grid(classifier) %>% 
  add_predictions(mod, "x")

ggplot(foo, aes(classifier, x)) + 
  geom_boxplot() +
  geom_point(data = grid, colour = "red", size = 4)
```
<br>
```{r Chapter 24.3.1 Plot 23 Sampling}
mod <- lm(x ~ sampling, data = foo)


grid <- foo %>% 
  data_grid(sampling) %>% 
  add_predictions(mod, "x")

ggplot(foo, aes(sampling, x)) + 
  geom_boxplot() +
  geom_point(data = grid, colour = "red", size = 4)
```
<br>
```{r Chapter 24.3.1 Plot 24}

foo <- foo %>% 
  add_residuals(mod)

foo %>% 
  ggplot(aes(y, resid)) + 
  geom_ref_line(h = 0) + 
  geom_line()
```
<br>
```{r Chapter 24.3.1 Plot 25 Classifier}
ggplot(foo, aes(y, resid, colour = classifier)) + 
  geom_ref_line(h = 0) + 
  geom_line()
```
<br>
```{r Chapter 24.3.1 Plot 25 Sampling}
ggplot(foo, aes(y, resid, colour = sampling)) + 
  geom_ref_line(h = 0) + 
  geom_line()
```
<br>
```{r Chapter 24.3.1 Plot 26}
foo %>% 
  ggplot(aes(y, resid)) + 
  geom_ref_line(h = 0) + 
  geom_line(colour = "grey50") + 
  geom_smooth(se = FALSE, span = 0.20)
```
<br>
```{r Chapter 24.3.1 Plot 27}
foo %>% 
  filter(classifier == "XGBoost") %>% 
  ggplot(aes(x, y)) + 
  geom_point() + 
  geom_line() 
```
```{r Chapter 24.3.1 Plot 28}
foo %>% 
  filter(classifier == "DecisionTree") %>% 
  ggplot(aes(x, y)) + 
  geom_point() + 
  geom_line() 
```
```{r Chapter 24.3.1 Plot 29}
foo %>% 
  filter(classifier == "Logistic Reg") %>% 
  ggplot(aes(x, y)) + 
  geom_point() + 
  geom_line() 
```
<br>
```{r Chapter 24.3.1 Plot 30 Classifier}
foo %>% 
  ggplot(aes(x, y, colour = classifier)) +
  geom_boxplot()
```
<br>
```{r Chapter 24.3.1 Plot 30 Sampling}
foo %>% 
  ggplot(aes(x, y, colour = sampling)) +
  geom_boxplot()
```
<br>
```{r Chapter 24.3.1 Plot 31}
mod3 <- lm(x ~ classifier, data = foo)
mod4 <- lm(y ~ classifier, data = foo)

foo %>% 
  gather_residuals(precision = mod3, recall = mod4) %>% 
  ggplot(aes(x, resid, colour = model)) +
  geom_line(alpha = 0.75)
```
```{r Chapter 24.3.1 Plot 32}
grid <- foo %>% 
  data_grid(x, classifier) %>% 
  add_predictions(mod2, "x")

ggplot(foo, aes(classifier, x)) +
  geom_boxplot() + 
  geom_point(data = grid, colour = "red") + 
  facet_wrap(~ classifier)
```
```{r Chapter 24.3.1 Plot 33}
library(splines)
mod6 <- MASS::rlm(x ~ classifier, data = foo)

foo %>% 
  add_residuals(mod6, "resid") %>% 
  ggplot(aes(y, resid)) + 
  geom_hline(yintercept = 0, size = 2, colour = "white") + 
  geom_line()
```
```{r Chapter 24.3.1 Plot 34}
foo %>% 
  data_grid(y, classifier) %>% 
  add_predictions(mod6) %>% 
  ggplot(aes(y, pred, colour = classifier)) + 
  geom_line() +
  geom_point()

```
<br>

## Chapter 25.1 Many Models
```{r Chapter 25.1 Classifier Plot 1}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
foo %>% 
  ggplot(aes(year, precision, group = classifier)) +
  geom_line(alpha = 1/3) +
    ggtitle("Classifier - Precision")
```
<br>
```{r Chapter 25.1 Classifier Plot 2}
foo %>% 
  ggplot(aes(year, recall, group = classifier)) +
  geom_line(alpha = 1/3) + 
  ggtitle("Classifier - Recall")
```
```{r Chapter 25.1 Sampling Plot 1}
foo %>% 
  ggplot(aes(year, precision, group = sampling)) +
  geom_line(alpha = 1/3) + 
  ggtitle("Sampling - Precision")
```
<br>
```{r Chapter 25.1 Sampling Plot 2}
foo %>% 
  ggplot(aes(year, recall, group = sampling)) +
  geom_line(alpha = 1/3) +
  ggtitle("Sampling - Recall")
```
<br>
```{r Chapter 25.1 Technique Plot 1}
foo %>% 
  ggplot(aes(year, precision, group = technique)) +
  geom_line(alpha = 1/3) +
  ggtitle("Technique - Precision")
```
```{r Chapter 25.1 Technique Plot 2}
foo %>% 
  ggplot(aes(year, recall, group = technique)) +
  geom_line(alpha = 1/3) +
  ggtitle("Technique - Recall")
```

<br>
```{r Chapter 25.1 XGBoost Precision Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
xg <- filter(foo, classifier == "XGBoost")
xg %>% 
  ggplot(aes(year, x)) + 
  geom_line() + 
  ggtitle("XGBoost Precision Full Data ")
```
<br>
```{r Chapter 25.1 Naive Bayes Precision Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
nb <- filter(foo, classifier == "Naive Bayes")
nb %>% 
  ggplot(aes(year, x)) + 
  geom_line() + 
  ggtitle("Naive Bayes Precision Full Data ")
```
<br>
```{r Chapter 25.1 Random Forest Precision Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
rf <- filter(foo, classifier == "Random Forest")
rf %>% 
  ggplot(aes(year, x)) + 
  geom_line() + 
  ggtitle("Random Forest Precision Full Data ")
```
<br> 
```{r Chapter 25.1 Logistic Regression Precision Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
lr <- filter(foo, classifier == "Logistic Reg")
lr %>% 
  ggplot(aes(year, x)) + 
  geom_line() + 
  ggtitle("Logistic Regression Precision Full Data ")
```
<br>
```{r Chapter 25.1 Decision Tree Precision Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
dt <- filter(foo, classifier == "DecisionTree")
dt %>% 
  ggplot(aes(year, x)) + 
  geom_line() + 
  ggtitle("Decision Tree Precision Full Data ")
```
<br>
```{r Chapter 25.1 XGBoost Recall Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
xg <- filter(foo, classifier == "XGBoost")
xg %>% 
  ggplot(aes(year, y)) + 
  geom_line() + 
  ggtitle("XGBoost Recall Full Data ")
```
<br>
```{r Chapter 25.1 Naive Bayes Recall Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
nb <- filter(foo, classifier == "Naive Bayes")
nb %>% 
  ggplot(aes(year, y)) + 
  geom_line() + 
  ggtitle("Naive Bayes Recall Full Data ")
```
<br>
```{r Chapter 25.1 Random Forest Recall Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
rf <- filter(foo, classifier == "Random Forest")
rf %>% 
  ggplot(aes(year, y)) + 
  geom_line() + 
  ggtitle("Random Forest Recall Full Data ")
```
<br>
```{r Chapter 25.1 Logistic Regression Recall Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
lr <- filter(foo, classifier == "Logistic Reg")
lr %>% 
  ggplot(aes(year, y)) + 
  geom_line() + 
  ggtitle("Logistic Regression Recall Full Data ")
```
<br>
```{r Chapter 25.1 Decision Tree Recall Full Data}
# foo = tibble(x=precision, y=recall, classifier=classifier, sampling=sampling, technique=technique, year=year)
dt <- filter(foo, classifier == "DecisionTree")
dt %>% 
  ggplot(aes(year, y)) + 
  geom_line() + 
  ggtitle("Decision Tree Recall Full Data ")
```
<br>
```{r Chapter 25.1 XGBoost Linear Trend}
xg_mod <- lm(x ~ y, classifier == "XGBoost", data = foo)
xg %>% 
  add_predictions(xg_mod) %>%
  ggplot(aes(year, pred)) + 
  geom_line() + 
  ggtitle("XGBoost Linear trend + ")
```
<br>
```{r Chapter 25.1 Logistic Reg Linear Trend}
lr_mod <- lm(x ~ y,  classifier == "Logistic Reg", data = foo)
lr %>% 
  add_predictions(lr_mod) %>%
  ggplot(aes(year, pred)) + 
  geom_line() + 
  ggtitle("Logistic Regression Linear trend + ")
```
<br>
```{r Chapter 25.1 Random Forest Linear Trend}
rf_mod <- lm(x ~ y, classifier == "Random Forest", data = foo)
rf %>% 
  add_predictions(rf_mod) %>%
  ggplot(aes(year, pred)) + 
  geom_line() + 
  ggtitle("Random Forest Linear trend + ")
```
<br>
```{r Chapter 25.1 Naive Bayes Linear Trend}
nb_mod <- lm(x ~ y,  classifier == "Naive Bayes", data = foo)
nb %>% 
  add_predictions(nb_mod) %>%
  ggplot(aes(year, pred)) + 
  geom_line() + 
  ggtitle("Naive Bayes Linear trend + ")
```
<br>
```{r Chapter 25.1 Decision Tree Linear Trend}
dt_mod <- lm(x ~ y, classifier == "DecisionTree", data = foo)
dt %>% 
  add_predictions(dt_mod) %>%
  ggplot(aes(year, pred)) + 
  geom_line() + 
  ggtitle("Decision Tree Linear trend + ")
```
<br>
```{r Chapter 25.1 XGBoost Pattern}
xg %>% 
  add_residuals(xg_mod) %>% 
  ggplot(aes(year, resid)) + 
  geom_hline(yintercept = 0, colour = "white", size = 3) + 
  geom_line() + 
  ggtitle("XGBoost Remaining pattern")
```
<br>
```{r Chapter 25.1 Logistic Regression Pattern}
lr %>% 
  add_residuals(lr_mod) %>% 
  ggplot(aes(year, resid)) + 
  geom_hline(yintercept = 0, colour = "white", size = 3) + 
  geom_line() + 
  ggtitle("Logistic Regression Remaining pattern")
```
<br>
```{r Chapter 25.1 Random Forest Pattern}
rf %>% 
  add_residuals(rf_mod) %>% 
  ggplot(aes(year, resid)) + 
  geom_hline(yintercept = 0, colour = "white", size = 3) + 
  geom_line() + 
  ggtitle("Random Forest Remaining pattern")
```
<br>
```{r Chapter 25.1 Naive Bayes Pattern}
nb %>% 
  add_residuals(nb_mod) %>% 
  ggplot(aes(year, resid)) + 
  geom_hline(yintercept = 0, colour = "white", size = 3) + 
  geom_line() + 
  ggtitle("Naive Bayes Remaining pattern")
```
<br>
```{r Chapter 25.1 Decision Tree Pattern}
dt %>% 
  add_residuals(dt_mod) %>% 
  ggplot(aes(year, resid)) + 
  geom_hline(yintercept = 0, colour = "white", size = 3) + 
  geom_line() + 
  ggtitle("Decision Tree Remaining pattern")
```
<br>
```{r Chapter 25.2.1 First}
by_side <- foo %>%
  group_by(classifier, sampling, technique) %>%
  nest()
by_side

```
<br> 
```{r Chapter 25.2.1 Second}
by_side$data[[1]]
```
<br>
```{r Chapter 25.1 List-Columns}
foo_model <- function(df){
  lm(x ~ y, data = df)
}
models <- map(by_side$data, foo_model)
by_side <- by_side %>% 
  mutate(model = map(data, foo_model))

# by_side %>%
#   filter(classifier == "XGBoost")

by_side %>% 
  arrange(classifier, sampling, technique)
by_side <- by_side %>% 
  mutate(
    resids = map2(data, model, add_residuals)
  )
by_side

resids <- unnest(by_side, resids)
resids

resids %>% 
  ggplot(aes(year, resid)) +
    geom_line(aes(group = classifier), alpha = 1 / 3) + 
    geom_smooth(se = FALSE) + 
    ggtitle("Classifier Residuals")
#> `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```
<br>
```{r Chapter 25.1 List-Columns 1}
resids %>% 
  ggplot(aes(year, resid)) +
    geom_line(aes(group = classifier), alpha = 1 / 3) + 
    geom_smooth(se = FALSE) + 
    ggtitle("Classifier Residuals")
#> `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```
<br>
```{r Chapter 25.1 List-Columns 2}
resids %>% 
  ggplot(aes(year, resid)) +
    geom_line(aes(group = technique), alpha = 1 / 3) + 
    geom_smooth(se = FALSE) + 
    ggtitle("Technique Residuals")
#> `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
```
<br>
```{r Chapter 25.1 Facet Classifier}
resids %>% 
  ggplot(aes(year, resid, group = technique)) +
    geom_line(alpha = 1 / 3) + 
    facet_wrap(~classifier)
```
<br>
```{r Chapter 25.1 Facet Technique}
resids %>% 
  ggplot(aes(year, resid, group = sampling)) +
    geom_line(alpha = 1 / 3) + 
    facet_wrap(~technique)
```
<br>
```{r Chapter 25.1 Facet Sampling}
resids %>% 
  ggplot(aes(year, resid, group = classifier)) +
    geom_line(alpha = 1 / 3) + 
    facet_wrap(~sampling)
```
<br>
```{r Chapter 25.2.4 Model Quality}
broom::glance(xg_mod)
broom::glance(nb_mod)
broom::glance(lr_mod)
broom::glance(dt_mod)
broom::glance(rf_mod)
```
<br>
```{r Chapter 25.2.4 Continued}
by_side %>% 
  mutate(glance = map(model, broom::glance)) %>% 
  unnest(glance)

glance <- by_side %>%
  mutate(glance = map(model, broom::glance)) %>%
  unnest(glance, .drop = TRUE)
# glance
glance %>% 
  arrange(r.squared)
```
<br>
```{r Chapter 25.2.4 Continued 2}
glance %>% 
  ggplot(aes(classifier, r.squared)) + 
    geom_jitter(width = 0.5) + 
  ggtitle("Classifier R.Squared")
# glance %>% 
#   ggplot(aes(sampling, r.squared)) + 
#     geom_jitter(width = 0.5) + 
#   ggtitle("Sampling R.Squared")
# Creating error: Validate mapping
# glance %>%
#   ggplot(aes(year, r.squared)) +
#   geom_jitter(width = 0.5) +
#   geom_jitter("Year R.Squared")
```
<br>
```{r Chapter 25.2.4 Continued 3}
glance %>% 
  ggplot(aes(sampling, r.squared)) + 
    geom_jitter(width = 0.5) + 
  ggtitle("Sampling R.Squared")
```
<br>
```{r Chapter 25 Final Plot}
bad_fit <- filter(glance, r.squared < 0.25)
bad_fit  
```
<br>
```{r Chapter 25.1 Semi Join}
foo %>%
semi_join(bad_fit, by = "classifier") %>% 
  ggplot(aes(year, x, colour = classifier)) +
    geom_line() + 
    ggplot("Classifier for Precision")
foo %>%
  semi_join(bad_fit, by = "classifier") %>% 
  ggplot(aes(year, y, colour = classifier)) +
    geom_line() + 
    ggplot("Classifier for Recall")
```


